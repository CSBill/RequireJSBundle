{% set compressed = compressed is defined ? compressed : true %}
{% set baseAssetParts = asset('bundles')|split('?', 2) %}
{% set config_extend %}
    require({
        baseUrl: {{ baseAssetParts[0]|json_encode|raw }},
        urlArgs: '{{ baseAssetParts[1] is defined ? baseAssetParts[1] : '' }}'
    });
    {{ config_extend|default('') }}
{% endset %}
<script type="text/javascript" src="{{ asset('bundles/oroui/lib/asap/asap.js') }}"></script>
{% if compressed and requirejs_build_exists() %}
    <script type="text/javascript">
        var require = (function(){
            var r=function(c){m(r.c,c)};r.c={};function m(a,b){
                for (var i in b)b[i]!=null&&b[i].toString()==='[object Object]'?m(a[i]||(a[i]={}),b[i]):a[i]=b[i]}
            return r;
        }());
        {{ config_extend|raw }}
        require = require.c;
    </script>
    <script type="text/javascript">
        (function() {
            /**
             * Must replace default require.nextTick on first setTimeout call
             * Default setTimeout implementation will be restored upon successfull replacement
             */
            var originalSetTimeout = window.setTimeout;
            window.setTimeout = function(fn, timeout) {
                try {
                    require.s.contexts._.nextTick = setImmediate;
                    require.nextTick = setImmediate;
                    window.setTimeout = originalSetTimeout;
                } catch (e) {
                    // wait next cycle
                }
                if (timeout === 0) {
                    return asap(fn);
                }
                setTimeout.apply(this, arguments);
            }
        })();
    </script>
    <script type="text/javascript" src="{{ asset(get_requirejs_build_path()) }}"></script>
{% else %}
    <script type="text/javascript" src="{{ asset('bundles/ororequirejs/lib/require.js') }}"></script>
    <script type="text/javascript">
        require.nextTick = setImmediate;
        require.s.contexts._.nextTick = setImmediate;
    </script>
    <script type="text/javascript">
        {{ get_requirejs_config() }}
    </script>
    <script type="text/javascript">
        {{ config_extend|raw }}
    </script>
{% endif %}
